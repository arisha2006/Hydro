<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3105/3105807.png">
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3105/3105807.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shumaim's Hydration Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --purple: #8e44ad; --light: #f4eef8; --white: #ffffff; }
        body, html { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; height: 100%; background: #fdfbff; overflow-x: hidden; }

        /* Login Styling */
        #login-screen { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background: linear-gradient(135deg, #a29bfe, #6c5ce7); color: white; }
        .login-box { background: white; padding: 40px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 300px; color: #333; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #eee; border-radius: 10px; box-sizing: border-box; }
        button { background: #6c5ce7; color: white; border: none; padding: 15px 30px; border-radius: 30px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 10px; transition: 0.3s; }
        
        /* Dashboard */
        #dashboard { display: none; padding-bottom: 50px; }
        .hero { background: url('https://images.unsplash.com/photo-1559839734-2b71f1e598c6?auto=format&fit=crop&w=800&q=80') center/cover; height: 250px; display: flex; align-items: flex-end; padding: 20px; color: white; font-weight: 600; font-size: 24px; box-shadow: inset 0 -100px 50px rgba(108, 92, 231, 0.6); }
        .container { padding: 20px; }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 8px solid #6c5ce7; }
        
        /* Alarm Overlay */
        #alarm-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(108, 92, 231, 0.98); z-index: 1000; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
        .ring-img { width: 200px; border-radius: 50%; border: 5px solid white; margin-bottom: 20px; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .time-item { display: flex; justify-content: space-between; padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 10px; font-size: 14px; color: #333;}
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color: #6c5ce7;">Sister's Hydrator âœ¨</h2>
            <p>Ready to glow, Shumaim?</p>
            <input type="text" id="user" placeholder="Username (shumaim)">
            <input type="password" id="pass" placeholder="Password (Areesha)">
            <button onclick="handleLogin()">Login to Health</button>
            <p id="error" style="color:red; font-size:12px;"></p>
        </div>
    </div>

    <div id="dashboard">
        <div class="hero">Hello, Shumaim! ðŸ’§</div>
        <div class="container">
            <div class="card">
                <h3>Step 1: Setup Alerts</h3>
                <button onclick="requestPermission()" style="background:#e67e22;">1. Allow Lockscreen Alerts</button>
                <h3 style="margin-top:20px;">Step 2: Start Time</h3>
                <input type="time" id="startTime" value="08:00" style="font-size: 18px;">
                <button onclick="setAlarms()">2. Activate My Schedule</button>
                <button onclick="testVoice()" style="background:#8e44ad; font-size: 12px; margin-top:5px;">Test Voice Now</button>
            </div>

            <div id="schedule-box" class="card" style="display:none;">
                <h3>Your Personalized Daily Plan</h3>
                <div id="timetable"></div>
                <p style="font-size:12px; color:#666; margin-top:15px;"><i>Even if you close the app, you will get a notification. Tap it to hear the alarm!</i></p>
            </div>
        </div>
    </div>

    <div id="alarm-overlay">
        <img src="https://images.unsplash.com/photo-1548932813-71ede5af3916?auto=format&fit=crop&w=300&q=80" class="ring-img">
        <h1>DRINK WATER, SHUMAIM!</h1>
        <p>Your health is your beauty. ðŸ’§</p>
        <button onclick="stopAlarm()" style="width:200px; background:white; color:#6c5ce7;">I Have Drank Water!</button>
    </div>

    <script>
        let alarmTimes = [];
        let wakeLock = null;

        // Register Service Worker for background tasks
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(() => console.log("Worker Active"));
        }

        async function requestPermission() {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') alert("Perfect! You will now get reminders on your lockscreen.");
        }

        function handleLogin() {
            if(document.getElementById('user').value === "shumaim" && document.getElementById('pass').value === "Areesha") {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                requestWakeLock();
            } else {
                document.getElementById('error').innerText = "Access Denied.";
            }
        }

        async function requestWakeLock() {
            try { if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen'); } catch (err) {}
        }

        function triggerVoice() {
            window.speechSynthesis.cancel(); // Clear queue
            const msg = new SpeechSynthesisUtterance("Shumaim Its time to drink water and keep yourself hydrated");
            msg.rate = 0.8; 
            msg.pitch = 1.1;
            window.speechSynthesis.speak(msg);
            
            if ("vibrate" in navigator) navigator.vibrate([500, 200, 500, 200, 500]);
            document.getElementById('alarm-overlay').style.display = 'flex';
        }

        function testVoice() { triggerVoice(); }
        function stopAlarm() { document.getElementById('alarm-overlay').style.display = 'none'; window.speechSynthesis.cancel(); }

        function setAlarms() {
            const start = document.getElementById('startTime').value;
            const container = document.getElementById('timetable');
            container.innerHTML = '';
            alarmTimes = [];

            let [h, m] = start.split(':').map(Number);
            for(let i=0; i < 10; i++) {
                let d = new Date();
                d.setHours(h + i, m, 0); 
                let timeStr = d.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
                alarmTimes.push(timeStr);

                container.innerHTML += `<div class="time-item"><b>Glass ${i+1}</b> <span>${timeStr}</span></div>`;
            }

            // Sync with Service Worker for background monitoring
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ type: 'SYNC_ALARMS', alarms: alarmTimes });
            }

            document.getElementById('schedule-box').style.display = 'block';
            
            // Keep a local check if app is open
            setInterval(() => {
                const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
                if(alarmTimes.includes(now)) {
                    triggerVoice();
                    alarmTimes = alarmTimes.filter(t => t !== now);
                }
            }, 15000);
        }

        // Listen for the Service Worker telling us to speak (after user taps notification)
        navigator.serviceWorker.addEventListener('message', event => {
            if (event.data.action === 'playAlarm') triggerVoice();
        });
    </script>
</body>
</html>